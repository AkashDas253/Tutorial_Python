## Middleware in Flask  

### Overview  
Middleware in Flask allows processing requests before they reach a route handler and modifying responses before they are sent to the client. Flask provides two main types of middleware:  

- **Before Request Processing** (`@app.before_request`)  
- **After Request Processing** (`@app.after_request`)  

---

## Before Request Middleware  
Executes **before** a request is processed by a route.  

```python
from flask import Flask, request

app = Flask(__name__)

@app.before_request
def before_request():
    print(f"Incoming request: {request.method} {request.path}")
```

---

## After Request Middleware  
Executes **after** a response is generated by a route.  

```python
@app.after_request
def after_request(response):
    response.headers["X-Custom-Header"] = "Custom Value"
    print("Response sent!")
    return response
```

---

## Error Handling Middleware  
Executes when an exception occurs.  

```python
@app.errorhandler(404)
def not_found(error):
    return {"error": "Not Found"}, 404
```

---

## Custom Middleware Using WSGI  
Middleware can also be implemented at the **WSGI level**.  

```python
class Middleware:
    def __init__(self, app):
        self.app = app

    def __call__(self, environ, start_response):
        print("Custom Middleware: Request received")
        return self.app(environ, start_response)

app.wsgi_app = Middleware(app)
```

---

## Authentication Middleware  
```python
from flask import jsonify

@app.before_request
def check_authentication():
    if request.path != "/login":
        token = request.headers.get("Authorization")
        if token != "Bearer secret_token":
            return jsonify({"error": "Unauthorized"}), 401
```

---

## Summary  

| Feature | Description |
|---------|------------|
| **Before Request** | `@app.before_request` for preprocessing |
| **After Request** | `@app.after_request` for modifying responses |
| **Error Handling** | `@app.errorhandler` for custom error messages |
| **WSGI Middleware** | Custom class wrapping the app |
| **Authentication Middleware** | Check API tokens before processing |
